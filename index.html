<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Water Tank Problem – Vanilla JS</title>

  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      background: #f5f5f5;
      padding: 40px 10px;
    }

    .container {
      background: #ffffff;
      padding: 24px;
      border-radius: 12px;
      max-width: 900px;
      width: 100%;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    }

    h1 {
      margin-top: 0;
      font-size: 22px;
      text-align: center;
    }

    .subtitle {
      text-align: center;
      font-size: 13px;
      color: #666;
      margin-bottom: 18px;
    }

    label {
      font-weight: 600;
      font-size: 14px;
      display: block;
      margin-bottom: 6px;
    }

    .input-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    input {
      flex: 1;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    button {
      padding: 8px 16px;
      border-radius: 8px;
      border: none;
      background: #007bff;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
    }

    button:hover {
      background: #0062cc;
    }

    .result {
      margin: 12px 0;
      font-size: 14px;
    }

    .error {
      color: #c62828;
      font-size: 13px;
    }

    .svg-wrapper {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 12px;
      background: #fafafa;
      overflow-x: auto;
    }

    .legend {
      display: flex;
      justify-content: center;
      gap: 16px;
      font-size: 12px;
      margin-top: 8px;
    }

    .legend-box {
      width: 14px;
      height: 14px;
      display: inline-block;
      margin-right: 4px;
    }

    .bar { background: #9e9e9e; }
    .water { background: #2196f3; }
  </style>
</head>

<body>
  <div class="container">
    <h1>Water Tank Problem</h1>
    <div class="subtitle">Trapped Rain Water Visualization (SVG)</div>

    <label>Block Heights</label>
    <div class="input-row">
      <input id="input" value="0,4,0,0,0,6,0,6,4,0" />
      <button onclick="run()">Compute</button>
    </div>

    <div class="result">
      Total Trapped Water: <strong id="output">–</strong> units
    </div>
    <div id="error" class="error"></div>

    <div class="svg-wrapper">
      <svg id="chart"></svg>

      <div class="legend">
        <div><span class="legend-box bar"></span>Block</div>
        <div><span class="legend-box water"></span>Water</div>
      </div>
    </div>
  </div>

  <script>
    // Parse input string into array
    function parseHeights(str) {
      return str.split(",").map(v => {
        const n = Number(v.trim());
        if (n < 0 || isNaN(n)) throw new Error("Invalid input");
        return n;
      });
    }

    // O(n) algorithm using prefix max
    function calculateWater(arr) {
      const n = arr.length;
      const left = [], right = [];
      left[0] = arr[0];
      for (let i = 1; i < n; i++) left[i] = Math.max(left[i - 1], arr[i]);

      right[n - 1] = arr[n - 1];
      for (let i = n - 2; i >= 0; i--) right[i] = Math.max(right[i + 1], arr[i]);

      let total = 0;
      const water = [];
      for (let i = 0; i < n; i++) {
        water[i] = Math.max(Math.min(left[i], right[i]) - arr[i], 0);
        total += water[i];
      }
      return { total, water };
    }

    // Draw SVG bars
    function drawSVG(heights, water) {
      const svg = document.getElementById("chart");
      svg.innerHTML = "";

      const scale = 20;
      const barWidth = 25;
      const gap = 6;
      const max = Math.max(...heights.map((h, i) => h + water[i]));
      const height = max * scale + 40;
      const width = heights.length * (barWidth + gap) + 20;

      svg.setAttribute("width", width);
      svg.setAttribute("height", height);
      svg.setAttribute("viewBox", `0 0 ${width} ${height}`);

      const baseY = height - 20;

      heights.forEach((h, i) => {
        const x = 10 + i * (barWidth + gap);

        if (h > 0) {
          svg.innerHTML += `<rect x="${x}" y="${baseY - h * scale}"
            width="${barWidth}" height="${h * scale}" fill="#9e9e9e"/>`;
        }

        if (water[i] > 0) {
          svg.innerHTML += `<rect x="${x}" y="${baseY - (h + water[i]) * scale}"
            width="${barWidth}" height="${water[i] * scale}" fill="#2196f3"/>`;
        }
      });
    }

    function run() {
      try {
        const heights = parseHeights(document.getElementById("input").value);
        const { total, water } = calculateWater(heights);
        document.getElementById("output").textContent = total;
        drawSVG(heights, water);
        document.getElementById("error").textContent = "";
      } catch {
        document.getElementById("error").textContent = "Invalid input values";
      }
    }

    run();
  </script>
</body>
</html>
